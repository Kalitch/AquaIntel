version: '3.9'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - '3001:3001'
    environment:
      PORT: 3001
      CORS_ORIGIN: http://localhost:3000
      USGS_BASE_URL: https://api.waterdata.usgs.gov/ogcapi/v0
      CACHE_TTL_SECONDS: 300
      WATER_PER_KWH: 1.8
      KWH_PER_AI_INFERENCE: 0.001
      KWH_PER_GPU_TRAINING_HOUR: 1.2
    healthcheck:
      test: ['CMD', 'wget', '--quiet', '--tries=1', 'http://localhost:3001/health']
      interval: 30s
      timeout: 5s
      retries: 3

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - '3000:80'
    depends_on:
      - backend
    environment:
      REACT_APP_API_BASE_URL: http://localhost:3001
